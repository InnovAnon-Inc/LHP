<html>
<head>

<script src="music3.js"></script>	
<script src="music4.js"></script>
<script>
function SongA (context, measureLength, pulses, pulsesP) {
		this.context = context;
		var measures = 1;
		var bf = 432;
		this.scale = [1/1, 16/15, 9/8, 6/5, 5/4, 4/3, 7/5, 3/2,	8/5, 5/3, 16/9, 15/8];
		var roots = [0, 2, 4, 5, 7, 9];
		this.lines  = new Array (pulses.length);
		this.linesP = new Array (pulsesP.length);
		var pl;
		for (pl = 0; pl < pulses.length; pl++)
			this.lines[pl]  = new Line (measureLength, measures, pulses[pl],  pulses[pl]  * measures * 1 / 2 + 1, pulsesP[pl] * measures / 3 + pl + 1);
		for (pl = 0; pl < pulsesP.length; pl++)
			this.linesP[pl] = new Line (measureLength, measures, pulsesP[pl], pulsesP[pl] * measures * 2 / 3 + 1, pulsesP[pl] * measures / 2 + pl + 1);
		
	
		this.progressionLength = 13;
		var root, p;
		var progressions = new Array (this.scale.length);
		for (p = root = 0; p < this.scale.length; p++) {
			var chordI    = applyChord (majorChord     (this.scale, root + roots[0]), bf);
			var chordii   = applyChord (minorChord     (this.scale, root + roots[1]), bf);
			var chordiii  = applyChord (minorChord     (this.scale, root + roots[2]), bf);
			var chordiii7 = applyChord (minor7Chord    (this.scale, root + roots[2]), bf);
			var chordIV   = applyChord (majorChord     (this.scale, root + roots[3]), bf);
			var chordV    = applyChord (majorChord     (this.scale, root + roots[4]), bf);
			var chordV7   = applyChord (dominant7Chord (this.scale, root + roots[4]), bf);
			var chordvi   = applyChord (minorChord     (this.scale, root + roots[5]), bf);
			var chordviid = applyChord (diminishedChord (this.scale, root + roots[6], bf);
			var progression = [chordI, chordV, chordii, chordvi];
			progressions[p] = progression;
			root += 5;
		}
		
		this.lp  = new Array (this.lines.length);
		this.lpP = new Array (this.linesP.length);
		
		var i;
		for (i = 0; i < this.lp.length; i++) {
			this.lp[i] = new Array (this.scale.length);
			for (p = 0; p < this.lp[i].length; p++) {
				this.lp[i][p] = transformChords (progressions[p], i, pulses[i], i + 0);
			}
		}
		for (i = 0; i < this.lpP.length; i++) {
			this.lpP[i] = new Array (this.scale.length);
			for (p = 0; p < this.lpP[i].length; p++) {
				this.lpP[i][p] = transformChords (progressions[p], i, pulsesP[i], 2 * i + 1);
			}
		}
		
		this.primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61];
		this.M  = product (this.primes.slice (0, this.lines.length));
		this.MP = product (this.primes.slice (0, this.linesP.length));
		this.mLm = measureLength * measures;
		
		this.p = 0;
		this.c = 0;
	}

try {
	var context = new AudioContext();
	var now = context.currentTime;
	now++;
	
	var measureLength1 = 3 * 60 / 40;
	var measureLength2 = 4 * 60 / 40;
	var pulses1  = [1, 1, 1];
	var pulsesP1 = [1, 1, 1];
	var pulses2  = [1, 1, 1];
	var pulsesP2 = [1, 1, 1];
	var s1 = new SongA (context, measureLength1, pulses1, pulsesP1);
	var s2 = new Song2 (context, measureLength2, pulses2, pulsesP2);
	var I = Math.floor (Math.random () * Number.MAX_SAFE_INTEGER);
	
	function cycle () {
		s1.play (now + measureLength1 * 0, I);
		s2.play (now + measureLength2 * 0, I);
		
		s1.play (now + measureLength1 * 1, I);
		s2.play (now + measureLength2 * 1, I);
		
		s1.play (now + measureLength1 * 2, I);
		s2.play (now + measureLength2 * 2, I);
		
		s1.play (now + measureLength1 * 3, I);
		
		now += measureLength1 * measureLength2;
	
		setTimeout(cycle, Math.max (0, (now - context.currentTime) * 1000 - 100));
	}
	cycle ();
} catch (e) { alert (e) }
</script>

</head>
</html>
